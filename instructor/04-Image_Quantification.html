<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Overview of Structural MRI (Pre)processing and Neuroimaging Analysis: sMRI Segmentation and Parcellation</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../04-Image_Quantification.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Overview of Structural MRI (Pre)processing and Neuroimaging Analysis
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Overview of Structural MRI (Pre)processing and Neuroimaging Analysis
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Overview of Structural MRI (Pre)processing and Neuroimaging Analysis
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 48%" class="percentage">
    48%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 48%" aria-valuenow="48" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../04-Image_Quantification.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-Image_Modalities.html">1. sMRI Acquisition and Modalities</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-Image_Cleanup.html">2. sMRI Clean-up</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-Image_Spatial_Normalization.html">3. sMRI Spatial Normalization</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. sMRI Segmentation and Parcellation
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#you-are-here">You Are Here!</a></li>
<li><a href="#segmentation-of-brain-tissues">Segmentation of brain tissues</a></li>
<li><a href="#tissue-segmentation-and-visualization-in-practice">Tissue segmentation and visualization in practice</a></li>
<li><a href="#segmenting-tissue-classes-into-sub-components-atlasing-parcellation">Segmenting tissue classes into sub-components: atlasing,
parcellation</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-Image_QC.html">5. sMRI Quality Control</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-Statistical_Analysis.html">6. sMRI Statistical Analysis</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-Reproducibility.html">7. sMRI Analysis: Reproducibility Considerations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-Image_Spatial_Normalization.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-Image_QC.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-Image_Spatial_Normalization.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: sMRI Spatial
        </a>
        <a class="chapter-link float-end" href="../instructor/05-Image_QC.html" rel="next">
          Next: sMRI Quality Control...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>sMRI Segmentation and Parcellation</h1>
        <p>Last updated on 2024-02-19 |

        <a href="https://github.com/carpentries-incubator/SDC-BIDS-sMRI/edit/main/episodes/04-Image_Quantification.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do we segment the brain into tissue classes ?</li>
<li>How do we further divide a tissue class into sub-components ?</li>
<li>How are volumetric and surface data defined ?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand and visualize tissue segmentation</li>
<li>Manipulate atlases to extract regions of interests</li>
<li>Visualize and interact with both volumetric and surface data</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="you-are-here">You Are Here!<a class="anchor" aria-label="anchor" href="#you-are-here"></a></h2>
<hr class="half-width"><figure><img src="../fig/episode_4/Course_flow_4.png" alt="course_flow" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="segmentation-of-brain-tissues">Segmentation of brain tissues<a class="anchor" aria-label="anchor" href="#segmentation-of-brain-tissues"></a></h2>
<hr class="half-width"><p>Brain anatomy is different for every individual. Brain tissues are
typically divided into:</p>
<ul><li>
<strong>grey matter (GM)</strong>, containing neuron cell
bodies</li>
<li>
<strong>white matter (WM)</strong>, including neuron connection
fibers wrapped in a special signal-accelerating substance called
myelin</li>
<li>
<strong>cerebro-spinal fluid (CSF)</strong>, a protecting fluid
present mostly around the brain but also within brain cavities called
ventricles</li>
</ul><p>Each class can inform on different aspects of the brain. Therefore it
is often useful to segment the brain in these tissue components for
further processing.</p>
<figure><img src="../fig/episode_4/GM_WM_CSF.png" alt="Brain tissue types" class="figure mx-auto d-block"></figure><p>An important aspect to keep in mind is that aging and disease can
cause tissue modifications. Common changes include a reduction in GM, as
in the case of ageing and neurodegenerative diseases such as
Alzheimer’s. A tumor can cause an important localized change of signal
in the area most impacted by the tumor. Another example is visibly
higher WM signal intensities on T2 MRI images, so called WM
hyper-intensities, which can be related to vascular pathology (common in
aging), or to myelin lesions characteristic of the multiple sclerosis
disease.</p>
<p><img src="../fig/episode_4/brain_atrophy_460px.jpg" alt="Brain atrophy due to Alzheimer's or severe multiple sclerosis disease" class="figure"><em>This image is Copyright © My-MS.org and falls under Image License D
defined under the Image License section of the My-MS.org Disclaimer
page.</em></p>
<p>The analysis of preprocessed structural images then often consists
in:</p>
<ol style="list-style-type: decimal"><li>Identifying tissue classes – including pathological tissue when
appropriate – and their sub-components: this is done by segmenting the
MRI images, and the topic of the current episode</li>
<li>Quantifying morphological differences: this is typically done by
measuring morphological properties such as GM volume or thickness in the
whole brain or within specific regions, and this is the topic of episode
6</li>
</ol><p>Can we measure brain changes in healthy young adults as well ? This
is what we will ultimately try to find out at the end of our lesson
!</p>
<p>In this episode we will more precisely look at:</p>
<ul><li>how to segment images into tissue classes, and also also sub-regions
for the case of GM</li>
<li>how to visualize segmentation results both for volumetric and
surface data</li>
</ul><div id="which-software-to-use-for-segmentation-and-parcellation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="which-software-to-use-for-segmentation-and-parcellation" class="callout-inner">
<h3 class="callout-title">Which software to use for segmentation and parcellation ?</h3>
<div class="callout-content">
<p>Common software to segment volumetric data include <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki" class="external-link">FSL</a>, <a href="https://www.fil.ion.ucl.ac.uk/spm" class="external-link">SPM</a> and <a href="https://stnava.github.io/ANTs" class="external-link">ANTS</a>. One of the most used
software to segment surface data (in addition of volumetric data) is <a href="https://surfer.nmr.mgh.harvard.edu" class="external-link">Freesurfer</a>. In this
episode, we will use the outputs generated by <a href="https://github.com/nipreps/smriprep" class="external-link">smriprep</a>/<a href="https://github.com/nipreps/fmriprep" class="external-link">fmriprep</a>, which are
workflows relying on all these software to generate a large variety of
segmentation outputs.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="tissue-segmentation-and-visualization-in-practice">Tissue segmentation and visualization in practice<a class="anchor" aria-label="anchor" href="#tissue-segmentation-and-visualization-in-practice"></a></h2>
<hr class="half-width"><p>The tissues can be differentiated according to the MRI signal
intensity, however as seen in episode 2, the main magnetic field can
introduce bias and create signal inhomogeneities. It is therefore
important to implement bias field correction before carrying out
segmentation according to tissue intensities.</p>
<p>Usually the T1 MRI modality is used for segmentation as it offers the
best contrast between GM, WM and CSF. However combining multiple
modalities (such as T2, PD and FLAIR) can help improving the
segmentation, especially in the presence of lesions.</p>
<p>Tissue segmentation is presented first for normal controls. Then
examples of changes that can happen in disease are shown for patients
having Alzheimer’s or the multiple sclerosis disease.</p>
<div class="section level3">
<h3 id="in-normal-controls">In normal controls<a class="anchor" aria-label="anchor" href="#in-normal-controls"></a></h3>
<p>In normal controls, the number of tissue classes is usually fixed
(there are not additional classes of pathological tissue). In practice,
a distribution of the intensity of the different tissue types can be
obtained by loading T1 volumes with <code>nibabel</code> then plotting a
slice with <code>matplotlib</code> and displaying an histogram with
<code>seaborn</code> (a plotting library built on top of
<code>matplotlib</code>). Assuming we already loaded a T1 brain volume
<code>t1_brain_data</code>, visualizing the T1 data and the associated
intensity histogram is obtained with:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Plot first figure</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>plt.imshow(t1_data[:, :, <span class="dv">110</span>], vmax<span class="op">=</span><span class="dv">300000</span>, origin<span class="op">=</span><span class="st">"lower"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>plt.title(<span class="st">'T1 data before skull-stripping'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Plot second figure</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>plt.imshow(t1_brain_data[:, :, <span class="dv">110</span>], vmax<span class="op">=</span><span class="dv">300000</span>, origin<span class="op">=</span><span class="st">"lower"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>plt.title(<span class="st">'T1 data after skull-stripping'</span>)</span></code></pre>
</div>
<figure><img src="../fig/episode_4/brain_axial_slice.png" alt="Axial slice of the T1 data (after skull-stripping)" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Compute the optimal bin size according to the data</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>bins <span class="op">=</span> np.histogram_bin_edges(t1_brain_data[t1_brain_data <span class="op">!=</span> <span class="dv">0</span>], bins<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># Plot the histogram</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>sns.histplot(t1_brain_data[t1_brain_data <span class="op">!=</span> <span class="dv">0</span>], bins<span class="op">=</span>bins)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">300000</span>])</span></code></pre>
</div>
<figure><img src="../fig/episode_4/intensity_distribution_all_tissues_together.png" alt="Histogram of the T1 volume data, all tissues together" class="figure mx-auto d-block"></figure><p>We can see here three main components corresponding to GM, WM and
CSF.</p>
<div id="jupyter-notebook-challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="jupyter-notebook-challenge" class="callout-inner">
<h3 class="callout-title">Jupyter notebook challenge</h3>
<div class="callout-content">
<p>Can you modify the code in the Jupyter notebook to plot the histogram
of the brain before skull-stripping ?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Hint </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Try to switch the variable of one T1 image for another.</p>
</div>
</div>
</div>
</div>
<p>We can visualize the segmentation by loading adding an overlay
representing the different tissue classes after segmentation. For this,
we use the <code>nilearn</code> library to plot the <code>t1_seg</code>
segmentation data from <code>smriprep/fmriprep</code>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> nilearn <span class="im">import</span> plotting</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>plotting.plot_roi(roi_img<span class="op">=</span>t1_seg, bg_img<span class="op">=</span>t1, alpha<span class="op">=</span><span class="fl">0.3</span>, cmap<span class="op">=</span><span class="st">"Set1"</span>)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/brain_slices_seg_overlay.png" alt="Tissue classes overlayed on the T1 data" class="figure mx-auto d-block"></figure><p>Now that we have access to each tissue class, we can check the
contribution of each in the intensity histogram.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>labels <span class="op">=</span> np.unique(t1_seg_data[t1_seg_data <span class="op">!=</span> <span class="dv">0</span>]).astype(<span class="st">'int'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>palette <span class="op">=</span> itertools.cycle(sns.color_palette(<span class="st">"Set3"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="cf">for</span> label <span class="kw">in</span> labels:</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    sns.histplot(t1_brain_data[t1_seg_data <span class="op">==</span> label], bins<span class="op">=</span>bins, color<span class="op">=</span><span class="bu">next</span>(palette), alpha<span class="op">=</span><span class="fl">0.6</span>)</span></code></pre>
</div>
<figure><img src="../fig/episode_4/intensity_distribution_per_tissue_class.png" alt="Histogram of the T1 volume data, one distribution per tissue" class="figure mx-auto d-block"></figure><div id="a-simple-matter-of-thresholding" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="a-simple-matter-of-thresholding" class="callout-inner">
<h3 class="callout-title">A simple matter of thresholding ?</h3>
<div class="callout-content">
<p>From the previous histogram, does the intensity itself seem enough to
differentiate between different tissue classes ?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>From the shape of the histogram we can see there is some overlap
between the tissue distributions. Segmentation on intensity alone is
most often not enough, and additional information is required, such as
the use of a template with a-priori tissue probability maps (probability
of presence of a given tissue at a given location).</p>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="a-question-of-probability">A question of probability<a class="anchor" aria-label="anchor" href="#a-question-of-probability"></a></h4>
<p>In the previous segmentation volume, each voxel has a single integer
value (1, 2 or 3) according to which tissue class it belongs. In
practice however the primary output of segmentation tools are
probability maps: one probability map per tissue class. In this
probability map, each voxel has a value between 0 and 1 to indicate the
probability to belong to that tissue class.</p>
<p>Below is an example of visualization of a GM probability map
<code>GM_probmap</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>plotting.plot_roi(roi_img<span class="op">=</span>GM_probmap, bg_img<span class="op">=</span>t1, alpha<span class="op">=</span><span class="fl">0.3</span>, cmap<span class="op">=</span><span class="st">"jet"</span>, vmin<span class="op">=</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="dv">1</span>)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/GM_probmap.png" alt="GM probability map" class="figure mx-auto d-block"></figure><p>The segmentation into GM and WM voxels allows to identify surfaces
surrounding these tissues. The images below show:</p>
<ul><li>on the left: the delineation of GM (in pink) and WM (in blue) before
discarding deep GM structures such as the basal ganglia</li>
<li>on the right: the delineation of the outer GM layer called the pial
surface (in red), and the underlying white matter surface (in blue)
after discarding deep GM</li>
</ul><figure><img src="../fig/episode_4/GM_WM_surfaces_delineation.png" alt="Delineation of GM and WM" class="figure mx-auto d-block"></figure><p>We can now have a closer look at surface data !</p>
</div>
<div class="section level4">
<h4 id="surface-data">Surface data<a class="anchor" aria-label="anchor" href="#surface-data"></a></h4>
<p>Some software such as Freesurfer specialize in surface data.
Contrarily to volumetric data which are collections of voxels, surface
data are collections of vertices and faces of a mesh.</p>
<figure><img src="../fig/episode_4/mesh.png" alt="Delineation of GM and WM" class="figure mx-auto d-block"></figure><p>The most commonly use surfaces are the pial GM and the underlying WM.
Let’s visualize the pial GM using <code>nilearn</code> on the Freesurfer
<code>pial_surf_file</code> output by <code>smriprep/fmriprep</code> and
loaded in the notebook.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># The pial surface is the most external surface of the GM</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>pial_surf <span class="op">=</span> nib.load(pial_surf_file)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>pial_verts, pial_faces <span class="op">=</span> pial_surf.agg_data((<span class="st">'pointset'</span>, <span class="st">'triangle'</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>plotting.plot_surf((pial_verts, pial_faces))</span></code></pre>
</div>
<figure><img src="../fig/episode_4/mesh_pial_NC.png" alt="Pial mesh from surface segmentation" class="figure mx-auto d-block"></figure><div id="jupyter-notebook-challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="jupyter-notebook-challenge-1" class="callout-inner">
<h3 class="callout-title">Jupyter notebook challenge</h3>
<div class="callout-content">
<p>Can you modify the code in the Jupyter notebook to plot the white
matter surface ?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Hint </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>Try to explore the BIDSLayout output to find the right surface
file.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="in-disease-such-as-alzheimers-and-multiple-sclerosis">In disease such as Alzheimer’s and multiple sclerosis<a class="anchor" aria-label="anchor" href="#in-disease-such-as-alzheimers-and-multiple-sclerosis"></a></h3>
<p>The brain GM volume tends to shrink with age, with the GM loss
typically replaced with CSF. This process is called atrophy. In
Alzheimer’s disease and other neuro-degenerative disease, atrophy is
amplified (the “degeneration” is the loss of GM). Therefore special care
is required when processing data of patients whose disease can cause
changes in the brain morphology.</p>
<p>Below is a T1 image of an Alzheimer’s disease patient. An enlargement
of the CSF-containing cavities, the ventricles, can be seen.</p>
<figure><img src="../fig/episode_4/NC_vs_AD.png" alt="WM mesh from surface segmentation" class="figure mx-auto d-block"></figure><p>Below is a T1 and FLAIR image of an MS patient. The lesion-enhancing
FLAIR modality clearly show lesions. These lesions can sometimes be seen
on the T1 image. In this case they appear as dark spots called “black
holes”.</p>
<figure><img src="../fig/episode_4/MS_T1_FLAIR_width640.png" alt="WM mesh from surface segmentation" class="figure mx-auto d-block"></figure><div id="segmentation-problems-in-disease" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="segmentation-problems-in-disease" class="callout-inner">
<h3 class="callout-title">Segmentation problems in disease</h3>
<div class="callout-content">
<p>What problems do you expect in the tissue segmentation of multiple
sclerosis images ?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>An algorithm expecting three tissues types may misclassify lesions as
GM on T1 images. Filling lesions with intensity corresponding to WM is a
solution sometimes used to avoid these issues (e.g. with Freesurfer).
Some software such as ANTs directly accepts a binary lesion mask as an
input to deal with this kind of data.</p>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="segmenting-tissue-classes-into-sub-components-atlasing-parcellation">Segmenting tissue classes into sub-components: atlasing,
parcellation<a class="anchor" aria-label="anchor" href="#segmenting-tissue-classes-into-sub-components-atlasing-parcellation"></a></h2>
<hr class="half-width"><p>A natural step after identifying tissue classes, is sub-dividing the
tissue(s) of interest into sub-components. GM is commonly split into
non-overlapping regions of interests (ROIs). This splitting process is
called “parcellation” and allows to be more specific about the brain
areas studied. Parcellation can be purely data-driven,
anatomically-driven, or both.</p>
<p>In this lesson we focus on GM. WM parcellation is also common but it
requires dedicated MRI sequences and analysis techniques, e.g. by
identifying group of WM tracts called bundles with tractography (please
refer to the lesson on diffusion MRI if you would like to know more
about WM parcellation).</p>
<p>The usefulness of an atlas comes from the fact that each subject
brain can be registered to the template on which that atlas is defined.
A correct registration to the template is therefore essential for a
correct labelling of the brain voxels / vertices. The template the
images are registered to should also be the template on which the atlas
has been defined (or highly similar).</p>
<div id="atlas-vs-parcellation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="atlas-vs-parcellation" class="callout-inner">
<h3 class="callout-title">Atlas vs Parcellation</h3>
<div class="callout-content">
<p>A parcellation can be defined as the splitting of an object into
non-overlapping components. Since an atlas divide the brain into
regions, atlasing can be considered a kind of parcellation.
Reciprocally, any kind of brain parcellation can be considered an
“atlas”.</p>
<p>A difference is that an atlas is often expected to be defined on an
entire brain, while a parcellation can be limited to a specific region
(e.g. thalamus parcellation). A parcellation can also be applied for
example to the cortical GM (the outer layer of the brain) or the
subcortical GM for deep GM (GM structures below the cortex).</p>
<p>Note that Freesurfer call cortical parcellation “parcellation”
(denoting <code>parc</code> the associated files) and subcortical
parcellation “segmentation” (denoting <code>seg</code> the associated
files).</p>
<p>The picture can be muddled when considering probabilistic atlases. In
this case each atlas region is associated to a probabilistic map. Just
like tissue probability maps, each voxel (or vertex) has a given
probability to belong to the region considered.</p>
<div id="probability-atlas-threshold" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="probability-atlas-threshold" class="callout-inner">
<h3 class="callout-title">Probability atlas threshold</h3>
<div class="callout-content">
<p>Given a probabilistic atlas, is there a single probability threshold
which would guaranteed each brain volume voxel (or surface vertices) to
have a unique label ? If yes, which threshold would you choose, and if
not how would you proceed ?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>In virtually all cases no single probability threshold will result in
each voxel (or vertex) belonging to a unique ROI. A high threshold will
result in voxels not having a label, while a low threshold will cause
voxels to belong to overlapping probability maps. A “true” parcellation
could be obtained by associating to each voxel (or vertex) the label
with the maximum probability.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="visualizing-and-extracting-rois-of-a-non-probabilistic-volumetric-atlas">Visualizing and extracting ROIs of a non probabilistic volumetric
atlas<a class="anchor" aria-label="anchor" href="#visualizing-and-extracting-rois-of-a-non-probabilistic-volumetric-atlas"></a></h3>
<p>An example of a volumetric atlas motivated by neuroanatomy is the
Automated Anatomical Labeling (AAL) atlas. Each ROI has an anatomically
meaningful text label. The atlas is aligned with the MNI MRI
single-subject brain. The atlas is represented as a 3D volume in which
each voxel has an integer index which corresponds to an ROI label,
e.g. <code>2401</code> for the
<code>left hemisphere supplementary motor area</code>.</p>
<p><code>Nilearn</code> offers a collection of atlases in its
<code>datasets</code> module. The AAL atlas, text labels and integer
indices can all be obtained through this module.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> nilearn.datasets <span class="im">import</span> fetch_atlas_aal</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>AAL_dataset <span class="op">=</span> fetch_atlas_aal()</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>AAL_maps <span class="op">=</span> AAL_dataset.maps</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>AAL_labels <span class="op">=</span> AAL_dataset[<span class="st">'labels'</span>]</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>AAL_labels_ix <span class="op">=</span> AAL_dataset[<span class="st">'indices'</span>]</span></code></pre>
</div>
<p>We can check the atlas dimension by loading it with
<code>nibabel</code></p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>AAL_img <span class="op">=</span> nib.load(AAL_maps)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>AAL_img.shape</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(91, 109, 91)</code></pre>
</div>
<div class="section level4">
<h4 id="plotting-the-atlas">Plotting the atlas<a class="anchor" aria-label="anchor" href="#plotting-the-atlas"></a></h4>
<p>To plot the atlas we can use as background either the template on
which it was defined (or one highly similar), or a subject volume
aligned with that template. In our case we use the <code>t1_mni</code>
volume of our subject and use the <code>plot_roi</code> function of the
<code>nilearn</code> <code>plotting</code> module to add the atlas as an
overlay:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>plotting.plot_roi(roi_img<span class="op">=</span>AAL_maps, bg_img<span class="op">=</span>t1_mni, alpha<span class="op">=</span><span class="fl">0.4</span>, title<span class="op">=</span><span class="st">"AAL atlas"</span>)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/AAL_atlas.png" alt="AAL atlas" class="figure mx-auto d-block"></figure><p>We can extract a specific ROI in two steps:</p>
<ol style="list-style-type: decimal"><li>Identify the integer index corresponding to the ROI</li>
<li>Get all the voxels corresponding to that index</li>
</ol></div>
<div class="section level4">
<h4 id="identifying-an-roi-integer-index">Identifying an ROI integer index<a class="anchor" aria-label="anchor" href="#identifying-an-roi-integer-index"></a></h4>
<p>Sometimes the integer index directly correspond to the label list
index, e.g. if “visual cortex” is in position 3 in AAL_dataset[‘labels’]
then the corresponding integer index in the image is 3. For the AAL
atlas, the ROI indices are not in the order of the text labels so
<code>nilearn</code> provide a list of ROI indices. Since the list of
labels match the list of indices we proceed in two steps:</p>
<ol style="list-style-type: decimal"><li>Find the position of the ROI in the list of AAL_labels</li>
<li>Use the same position in the list of indices</li>
</ol><div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>roi_label <span class="op">=</span> <span class="st">"Supp_Motor_Area_L"</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>roi_label_pos <span class="op">=</span> AAL_labels.index(roi_label)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>roi_ix <span class="op">=</span> <span class="bu">int</span>(AAL_labels_ix[roi_label_pos])</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="bu">print</span>(roi_ix)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">2401</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="getting-all-voxels-corresponding-to-that-index">Getting all voxels corresponding to that index<a class="anchor" aria-label="anchor" href="#getting-all-voxels-corresponding-to-that-index"></a></h4>
<p>To create a binary ROI image from the ROI index, we:</p>
<ol style="list-style-type: decimal"><li>Create a boolean array with <code>True</code> if the voxel label is
equal to our ROI index, and <code>False</code> if not</li>
<li>Convert the boolean array to integer</li>
</ol><div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>roi_mask_arr_bool <span class="op">=</span> (AAL_img.get_fdata() <span class="op">==</span> roi_ix)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>roi_mask_arr <span class="op">=</span> roi_mask_arr_bool.astype(<span class="bu">int</span>)</span></code></pre>
</div>
<p>To create a <code>nibabel</code> image object, we then need to attach
the original image affine transform</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>roi_mask <span class="op">=</span> nib.Nifti1Image(roi_mask_arr, affine<span class="op">=</span>AAL_img.affine)</span></code></pre>
</div>
<p>we can now plot the ROI using the <code>plot_roi</code> function of
<code>nilearn</code></p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>plotting.plot_roi(roi_img<span class="op">=</span>roi_mask, bg_img<span class="op">=</span>t1_mni, alpha<span class="op">=</span><span class="fl">0.4</span>, title<span class="op">=</span>roi_label)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/AAL_roi.png" alt="ROI from the AAL atlas" class="figure mx-auto d-block"></figure></div>
</div>
<div class="section level3">
<h3 id="visualizing-and-extracting-rois-of-a-surface-atlas">Visualizing and extracting ROIs of a surface atlas<a class="anchor" aria-label="anchor" href="#visualizing-and-extracting-rois-of-a-surface-atlas"></a></h3>
<p>For the previous atlas, the unit elements to receive a label were
voxels. When considering the surface of the cortex, unit elements are
the vertices of the surface mesh. Each such vertex can receive a label,
and the result is a surface parcellation.</p>
<p>Freesurfer relies on two surface atlases: the Desikan-Killiany Atlas
with 68 ROIs and the Destrieux Atlas with 148 ROIs. The Destrieux atlas
is part of the nilearn datasets and we will focus on this atlas in the
lesson.</p>
<p>Surface datasets are split in left and right hemisphere. Let’s aim at
plotting the left hemisphere. As we will see also how to plot a specific
ROI, we will also extract the atlas labels.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">from</span> nilearn.datasets <span class="im">import</span> fetch_atlas_surf_destrieux</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>parcellation_L <span class="op">=</span> destrieux[<span class="st">'map_left'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>destrieux_labels <span class="op">=</span> destrieux[<span class="st">'labels'</span>]</span></code></pre>
</div>
<div class="section level4">
<h4 id="plotting-the-atlas-1">Plotting the atlas<a class="anchor" aria-label="anchor" href="#plotting-the-atlas-1"></a></h4>
<p>For plotting a 3D volume we needed a 3D image template. For a
surface, we need a 3D surface (also called mesh) template. The Destrieux
atlas we collected is defined on the fsaverage5 Freesurfer template, so
we will need it to plot our atlas.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>fsaverage <span class="op">=</span> fetch_surf_fsaverage()</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>mesh <span class="op">=</span> fsaverage[<span class="st">'pial_left'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>plotting.plot_surf_roi(mesh, roi_map<span class="op">=</span>parcellation_L,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>                       hemi<span class="op">=</span><span class="st">'left'</span>, view<span class="op">=</span><span class="st">'lateral'</span>)<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/destrieux_atlas_left.png" alt="Left hemisphere of the Destrieux surface atlas" class="figure mx-auto d-block"></figure></div>
<div class="section level4">
<h4 id="extracting-a-specific-roi">Extracting a specific ROI<a class="anchor" aria-label="anchor" href="#extracting-a-specific-roi"></a></h4>
<p>To extract a specific ROI, we can proceed as we did for the AAL atlas
but using the Destrieux labels.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>pcc_region <span class="op">=</span> <span class="st">b'G_cingul-Post-dorsal'</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>roi_ix <span class="op">=</span> destrieux_labels.index(pcc_region)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>roi_mask_arr <span class="op">=</span> (parcellation_L <span class="op">==</span> roi_ix).astype(<span class="bu">int</span>)</span></code></pre>
</div>
<p>To plot that ROI, we can use the <code>plot_surf_roi</code> function
of the <code>nilearn</code> <code>plotting</code> module. We will plot
the medial view since this ROI is located towards the central part of
the brain. We will also use the template as background image since most
vertices do not have a label to be plotted.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>plotting.plot_surf_roi(mesh, roi_map<span class="op">=</span>roi_mask_arr, hemi<span class="op">=</span><span class="st">'left'</span>, view<span class="op">=</span><span class="st">'medial'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>                       bg_map<span class="op">=</span>fsaverage[<span class="st">'sulc_left'</span>])<span class="op">;</span></span></code></pre>
</div>
<figure><img src="../fig/episode_4/roi_destrieux.png" alt="ROI of the Destrieux surface atlas" class="figure mx-auto d-block"></figure><div id="jupyter-notebook-challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="jupyter-notebook-challenge-2" class="callout-inner">
<h3 class="callout-title">Jupyter notebook challenge</h3>
<div class="callout-content">
<p>Can you modify the code in the Jupyter notebook to extract and
display the right precuneus ?</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Hint </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<p>This exercise involves a change of both ROI and hemisphere.</p>
</div>
</div>
</div>
</div>
<p>Because atlases can be overlaid on a subject brain registered to the
atlas template, one can extract measurements specific to that subject
within each atlas ROI. We will see common metrics and how to extract
them in episode 6, and the important role of the WM and GM pial surfaces
for this purpose.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Brain segmentation and parcellation is a key step towards further
analysis</li>
<li>The brain can be represented via different data format (volume,
surface)</li>
<li>Multiple python libraries are particularly useful to manipulate
brain data</li>
</ul></div>
</div>
</div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/03-Image_Spatial_Normalization.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/05-Image_QC.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/03-Image_Spatial_Normalization.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: sMRI Spatial
        </a>
        <a class="chapter-link float-end" href="../instructor/05-Image_QC.html" rel="next">
          Next: sMRI Quality Control...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/SDC-BIDS-sMRI/edit/main/episodes/04-Image_Quantification.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/SDC-BIDS-sMRI/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/SDC-BIDS-sMRI/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/SDC-BIDS-sMRI/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:nikhil.bhagwat@mcgill.ca">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries-incubator.github.io/SDC-BIDS-sMRI/instructor/04-Image_Quantification.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "sMRI Segmentation and Parcellation",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/SDC-BIDS-sMRI/instructor/04-Image_Quantification.html",
  "identifier": "https://carpentries-incubator.github.io/SDC-BIDS-sMRI/instructor/04-Image_Quantification.html",
  "dateCreated": "2025-02-26",
  "dateModified": "2024-02-19",
  "datePublished": "2025-05-06"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

